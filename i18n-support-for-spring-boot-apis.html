<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Person">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>I18n support for Spring boot APIs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Kannan Ramamoorthy">

  <link rel="shortcut icon" href="">

  <!-- schema.org -->
  <meta itemprop="name" content="My Tech Buddy">
  <meta itemprop="image" content="">
  <meta itemprop="description" content="">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="./theme/css/milligram.css" type="text/css" />
  <link rel="stylesheet" href="./theme/css/custom.css" type="text/css" />

  <!-- Feed Meta Data -->

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="./i18n-support-for-spring-boot-apis.html">
<meta name="twitter:title" content="My Tech Buddy ~ I18n support for Spring boot APIs">
<meta name="twitter:description" content="About: This document is intended for the developers who implement i18n in their Spring/Spring boot application. Since the available articles in the net are not quite helpful on why we have to do certain things, writing this documentation to help people start with the i18n for Spring-boot apps. Introduction …">

<!-- Facebook Meta Data -->
<meta property="og:title" content="My Tech Buddy ~ I18n support for Spring boot APIs" />
<meta property="og:description" content="About: This document is intended for the developers who implement i18n in their Spring/Spring boot application. Since the available articles in the net are not quite helpful on why we have to do certain things, writing this documentation to help people start with the i18n for Spring-boot apps. Introduction …" />
<meta property="og:image" content="" />
</head>

<body>
    <div class="container">

    <!-- Navbar -->
      <div class="navbar">
        <ul>
            <div>
                <li>
                    <a href="."><h3>My Tech Buddy</h3></a>
                </li>
                <li>
                </li>
            </div>
        </ul>
      </div>

  <!-- Sidebar -->
    <sidebar>
        <ul class="static-item">

        </ul>        

        <ul>
                <div class="cat-border">
                <li style="color: #F2F1EF; background-color: #6C7A89;">Categories</li>
                    <li><a href="./category/computer-science-algorithm.html">Computer Science, Algorithm</a></li>
                    <li><a href="./category/diy.html">DIY</a></li>
                    <li><a href="./category/docker.html">Docker</a></li>
                    <li><a href="./category/documentation.html">Documentation</a></li>
                    <li><a href="./category/java-java-debugging.html">Java, Java Debugging</a></li>
                    <li><a href="./category/java-spring.html">Java Spring</a></li>
                    <li><a href="./category/mathematics.html">Mathematics</a></li>
                    <li><a href="./category/software.html">Software</a></li>
                </div>
        </ul>

   
        <p> 
                <span>
                    <a href="https://github.com/kannangce" target="_blank">
                        <img class="social-icons-m" src="./theme/images/icons/github.png">
                    </a>
                </span>
                <span>
                    <a href="https://twitter.com/kannangce" target="_blank">
                        <img class="social-icons-m" src="./theme/images/icons/twitter.png">
                    </a>
                </span>
        </p>
        <p>
        </p>
        <p>
        </p>
    </sidebar>
    
    <maincontent>
<h2>
    <a href="./i18n-support-for-spring-boot-apis.html" rel="bookmark" title="Permalink to I18n support for Spring boot APIs">I18n support for Spring boot APIs</a>
</h2>

<div>
    <b>By: </b><a href="./author/kannan-ramamoorthy.html">Kannan Ramamoorthy</a><b>    On: </b>Sun 08 July 2018<br />
    <b>In: </b><a href="./category/java-spring.html" rel="bookmark" title="Permalink to Java Spring">Java Spring</a><br />
    <em><b>Tags: </b>
                <span><a href="./tag/spring-boot.html">#Spring Boot </a></span>
                <span><a href="./tag/spring.html">#Spring </a></span>
                <span><a href="./tag/i18n.html">#I18n </a></span>
                <span><a href="./tag/l10n.html">#L10n </a></span>
                <span><a href="./tag/java.html">#Java </a></span>
    </em>
    <hr>
</div>

<div>
    <mainarticle>
    <h1 id="_about" class="sect0">About:</h1>
<div class="paragraph">
<p>This document is intended for the developers who implement <code>i18n</code> in their <code>Spring/Spring boot</code> application.</p>
</div>
<div class="paragraph">
<p>Since the available articles in the net are not quite helpful on why we have to do certain things, writing this documentation to help people start with the <code>i18n</code> for Spring-boot apps.</p>
</div>
<h1 id="_introduction" class="sect0">Introduction</h1>
<div class="paragraph">
<p>With <code>i18n</code> we&#8217;ll make sure that our app is capable of responding the requests in the specific locales of the client.
The scope of this document is not to address all the edge cases of the i18n support but to provide the technical help on facilitating the i18n support in Spring-boot applications, along with the answers for <strong>why</strong> of the technical part. Further, this focuses only the <code>i18n</code> support based on <code>accept-language</code> header.</p>
</div>
<div class="paragraph">
<p>Also please note that this is not <strong>the way</strong>, it is one of a neat way possible in Spring-boot.</p>
</div>
<h1 id="_how" class="sect0">How?</h1>
<div class="paragraph">
<p>For <code>i18n</code>, typically you will not hardcode any string within your code, and have it defined as <code>property</code> files for each language you support, outside your code.</p>
</div>
<div class="sect1">
<h2 id="_steps">Steps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_define_the_messages_class">1. Define the Messages class</h3>
<div class="paragraph">
<p>The below class will be the facade that returns the message in required locale for a given key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>@Component
public class Messages
{
    @Autowired
    private MessageSource messageSource;

    private MessageSourceAccessor accessor;

    // To let the messages accessed statically
    private static Messages ownInstance;

    // Default locale for your app.
    // app.default.locale expected to be available in application.properties/yml
    @Value("${app.default.locale}")
    private String defaultLocale;

    @PostConstruct
    public void init()
    {
        Locale.setDefault(new Locale(defaultLocale));
        accessor = new MessageSourceAccessor(messageSource);
        ownInstance = this;
    }

    private String getString(String key)
    {
        try
        {
            return accessor.getMessage(key);
        } catch (MissingResourceException e)
        {
            return '!' + key + '!';
        }
    }

    /**
     * Returns the Locale specific message from the configured
     * {@link MessageSource}
     *
     * @param theKey
     *            The key for which the message will be returned.
     * @return The message string associated with the given key.
     */
    public static String getMessage(String theKey)
    {
        return ownInstance.getString(theKey);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_initialize_messagesource">2. Initialize MessageSource</h3>
<div class="paragraph">
<p>The <code>MessageSource</code> abstracts the source from which the value of a string is being fetched.</p>
</div>
<div class="paragraph">
<p>In the <code>@configuration</code> class, you have to initialize a <code>MessageSource</code>.</p>
</div>
<div class="paragraph">
<p>Please note that the method name should be <code>messageSource</code> or else you have to explicitly define the id of the <code>@Bean</code> to be <code>messageSource</code>. The reason is Spring&#8217;s convention.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    @Bean
    public MessageSource messageSource()
    {
        ReloadableResourceBundleMessageSource aMessageSrc = new ReloadableResourceBundleMessageSource();
        // all files under the classpath with prefix messages
        aMessageSrc.setBasename("classpath:messages");
        return aMessageSrc;
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_initialize_localeresolver">3. Initialize LocaleResolver</h3>
<div class="paragraph">
<p>The <code>LocaleResolver</code> takes the responsibility of resolves the Locale for each request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    @Bean
    public LocaleResolver localeResolver()
    {
        SessionLocaleResolver slr = new SessionLocaleResolver();
        return slr;
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_externalize_strings">4. Externalize strings</h3>
<div class="paragraph">
<p>Externalize the hardcoded strings that could be responses for API. And store in <strong>message_&lt;locale&gt;.properties</strong>, so that the values of the properties will be your actual message for a specific locale.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Eclipse users can take the help from eclipse. To use it right click on src project open "Source"&gt;"Externalize Strings&#8230;&#8203;"</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_5_refer_the_messages_using_keys">5. Refer the messages using keys</h3>
<div class="paragraph">
<p>In your actual code, use the below call to get the respective message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Messages.getMessage("mesage_key");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_6_i18n_in_filter">6. I18n in Filter</h3>
<div class="paragraph">
<p>If you have filters(classes that extend <code>Filter</code>), you would be required to add the below line in the <code>doFilter</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>LocaleContextHolder.setLocale(request.getLocale());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_7_i18n_in_security_filtersuntested">7 . I18n in Security Filters(untested)</h3>
<div class="paragraph">
<p>If you are using Spring Security filters, you will be required to add the below initialization in the configuration.</p>
</div>
<div class="paragraph">
<p>The configuration class is expected to extend <code>WebMvcConfigurerAdapter</code> to make use of <code>addInterceptors</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>   @Bean
   public LocaleChangeInterceptor localeChangeInterceptor() {
       LocaleChangeInterceptor lci = new LocaleChangeInterceptor();
       return lci;
   }

   @Override
   public void addInterceptors(InterceptorRegistry registry) {
       registry.addInterceptor(localeChangeInterceptor());
   }</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_why_part" class="sect0">Why part?</h1>
<div class="sect1">
<h2 id="_why_reloadableresourcebundlemessagesource">Why <code>ReloadableResourceBundleMessageSource</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The below is an excerpt from Javadoc of the class,
 &gt; This strategy is not only capable of reloading files based on timestamp changes, but also of loading properties files with a specific character encoding. It will detect XML property files as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_sessionlocaleresolver">Why <code>SessionLocaleResolver</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SessionLocaleResolver</code> supports the below support,
- Support for default local, when <code>defaultLocale</code> set, that will be used.
- If Locale not set, along with <code>LocaleChangeInterceptor</code> we can use <strong>query param</strong> to choose the locale.
- Support to locale from from <strong>'Accept-language'</strong> header.
- Support to control Locale through <strong>cookie</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_to_explicitly_set_locale_for_filter">Why to explicitly set locale for Filter?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adding <code>LocaleChangeInterceptor</code> intercepter didn&#8217;t help, as the interceptor&#8217;s <code>preHandle</code> method is running after the <code>doFilter</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_to_add_interceptor_and_adding_it_to_registry_for_security_filter">Why to add Interceptor and adding it to registry for Security filter?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Responsibility of <code>LocaleChangeInterceptor</code> is to set the <code>Locale</code> for the request. Adding the <code>LocaleChangeInterceptor</code> config instantiates it.  To ensure that it is being invoked we are adding it to interceptor.</p>
</div>
</div>
</div>
<h1 id="_sample" class="sect0">Sample:</h1>
<div class="paragraph">
<p>Checkout <a href="https://github.com/kannangce/spring-boot-demos/tree/master/i18n">this project</a> for a sample <code>i18n</code> implementation, using the simple values in <code>accept-language</code> in header.</p>
</div>

    </mainarticle>
</div>
<hr>

<div>
        <i>If you found the article helpful, please share or cite the article, and spread the word:</i>
            <p style="margin-top: 2%;">
                <span><a target="_blank" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;" title="Twitter" href="https://twitter.com/share?url=./i18n-support-for-spring-boot-apis.html&text=I18n support for Spring boot APIs&via="><img class="social-icons-a" src="./theme/images/icons/twitter.png"></a></span>
                <span><a target="_blank" title="Facebook" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;" href="https://www.facebook.com/sharer.php?u=./i18n-support-for-spring-boot-apis.html&t=I18n support for Spring boot APIs"><img class="social-icons-a" src="./theme/images/icons/facebook.png"></a></span>

                <a  target="_blank" title="Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=./i18n-support-for-spring-boot-apis.html&title=I18n support for Spring boot APIs" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img class="social-icons-a" src="./theme/images/icons/linkedin.png"></a>
            </p>
</div>
<hr>
    <p><i>For any feedback or corrections, please write in to: </i><b> kannangce@rediffmail.com </b></p>

    <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "kannangce-in"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
    </maincontent>

  <!-- Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-127824340-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </div>
</body>

</html>